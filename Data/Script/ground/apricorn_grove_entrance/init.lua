--[[
    init.lua
    Created: 07/13/2023 19:44:56
    Description: Autogenerated script file for the map apricorn_grove_entrance.
]]--
-- Commonly included lua functions and data
require 'common'
require 'PartnerEssentials'
require 'ground.apricorn_grove_entrance.apricorn_grove_entrance_ch_4'

-- Package name
local apricorn_grove_entrance = {}

-- Local, localized strings table
-- Use this to display the named strings you added in the strings files for the map!
-- Ex:
--      local localizedstring = MapStrings['SomeStringName']
local MapStrings = {}

-------------------------------
-- Map Callbacks
-------------------------------
---apricorn_grove_entrance.Init(map)
--Engine callback function
function apricorn_grove_entrance.Init(map)

	DEBUG.EnableDbgCoro()
	print('=>> Init_apricorn_grove_entrance <<=')
	MapStrings = COMMON.AutoLoadLocalizedStrings()
	COMMON.RespawnAllies(true)
	PartnerEssentials.InitializePartnerSpawn()

end

---apricorn_grove_entrance.Enter(map)
--Engine callback function
function apricorn_grove_entrance.Enter(map)

  apricorn_grove_entrance.PlotScripting()

end

---apricorn_grove_entrance.Exit(map)
--Engine callback function
function apricorn_grove_entrance.Exit(map)


end

---apricorn_grove_entrance.Update(map)
--Engine callback function
function apricorn_grove_entrance.Update(map)


end

---apricorn_grove_entrance.GameSave(map)
--Engine callback function
function apricorn_grove_entrance.GameSave(map)

	PartnerEssentials.SaveGamePartnerPosition(CH('Teammate1'))

end

---apricorn_grove_entrance.GameLoad(map)
--Engine callback function
function apricorn_grove_entrance.GameLoad(map)

	PartnerEssentials.LoadGamePartnerPosition(CH('Teammate1'))
	apricorn_grove_entrance.PlotScripting()

end


function apricorn_grove_entrance.PlotScripting()
	if SV.ChapterProgression.Chapter == 4 then 
		if not SV.Chapter4.EnteredGrove then--first time
			apricorn_grove_entrance_ch_4.FirstAttemptCutscene()
		elseif not SV.Chapter4.FinishedGrove and not SV.Chapter4.ReachedGlade and not SV.ApricornGrove.InDungeon then 
			apricorn_grove_entrance_ch_4.SubsequentAttemptCutscene()--failed; hasn't made it to the end yet
		elseif not SV.Chapter4.FinishedGrove and SV.Chapter4.ReachedGlade and not SV.ApricornGrove.InDungeon then  
			apricorn_grove_entrance_ch_4.FailedNoFullTeamReattempt()--failed; made it to the end, but couldn't get the apricorn
		elseif not SV.Chapter4.FinishedGrove and SV.ApricornGrove.InDungeon and not SV.Chapter4.BacktrackedOutGroveYet then
			apricorn_grove_entrance_ch_4.FirstComeOutFront()--Came out the front from the dungeon for the first time
		elseif not SV.Chapter4.FinishedGrove and SV.ApricornGrove.InDungeon and SV.Chapter4.BacktrackedOutGroveYet then
			apricorn_grove_entrance.ComeOutFront()--generic come out front from dungeon
		else
			GAME:FadeIn(20)--this should never happen in actual gameplay, but useful for debug warping here
		end
	else
		if SV.ApricornGrove.InDungeon then
			apricorn_grove_entrance.ComeOutFront()
		else 
			GAME:FadeIn(20)
		end
	end
end

--Generic come out front cutscene
function apricorn_grove_entrance.ComeOutFront() 

end

-------------------------------
-- Entities Callbacks
-------------------------------
function apricorn_grove_entrance.Teammate1_Action(chara, activator)
  DEBUG.EnableDbgCoro() --Enable debugging this coroutine
  PartnerEssentials.GetPartnerDialogue(CH('Teammate1'))
 end

function apricorn_grove_entrance.Teammate2_Action(chara, activator)
  DEBUG.EnableDbgCoro() --Enable debugging this coroutine
  COMMON.GroundInteract(activator, chara, true)
end

function apricorn_grove_entrance.Teammate3_Action(chara, activator)
  DEBUG.EnableDbgCoro() --Enable debugging this coroutine
  COMMON.GroundInteract(activator, chara, true)
end
 
return apricorn_grove_entrance

